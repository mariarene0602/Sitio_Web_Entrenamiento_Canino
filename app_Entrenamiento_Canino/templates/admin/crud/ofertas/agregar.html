{% extends "admin/crud/base_crud.html" %}

{% block page_title %}Agregar Oferta{% endblock %}
{% block page_subtitle %}Nuevo cupón vinculado a curso{% endblock %}

{% block page_actions %}
<a href="{% url 'ver_ofertas' %}" class="admin-btn-warning">
    <i class="fas fa-arrow-left"></i> Volver a la Lista
</a>
{% endblock %}

{% block card_icon %}tag{% endblock %}
{% block card_title %}Datos de la Oferta{% endblock %}

{% block card_content %}
<!-- IMPORTANTE: enctype para subir fotos -->
<form method="POST" action="{% url 'agregar_oferta' %}" class="needs-validation" novalidate enctype="multipart/form-data">
    {% csrf_token %}
    
    {% if error %}
    <div class="alert alert-danger">{{ error }}</div>
    {% endif %}
    
    <div class="row">
        <!-- SELECCIÓN DE CURSO -->
        <div class="col-md-12 mb-3">
            <label for="curso" class="form-label">Curso Aplicable (Opcional)</label>
            <select class="form-select admin-form-control" id="curso" name="curso">
                <option value="">-- Oferta General (Para todos) --</option>
                {% for curso in cursos %}
                <option value="{{ curso.id }}">{{ curso.nombre }} - ${{ curso.precio }}</option>
                {% endfor %}
            </select>
            <div class="form-text">Si seleccionas un curso, la oferta se mostrará relacionada a él.</div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-6 mb-3">
            <label for="codigo" class="form-label">Código del Cupón *</label>
            <input type="text" class="form-control admin-form-control text-uppercase" id="codigo" name="codigo" 
                   placeholder="Ej: PUPPY2025" required>
        </div>
        
        <div class="col-md-6 mb-3">
            <label for="porcentaje_descuento" class="form-label">Descuento (%) *</label>
            <div class="input-group">
                <input type="number" class="form-control admin-form-control" id="porcentaje_descuento" name="porcentaje_descuento" 
                       min="1" max="100" placeholder="Ej: 20" required>
                <span class="input-group-text">%</span>
            </div>
        </div>
    </div>
    
    <div class="mb-3">
        <label for="descripcion" class="form-label">Descripción</label>
        <textarea class="form-control admin-form-control" id="descripcion" name="descripcion" rows="2" 
                  placeholder="Ej: Descuento especial por lanzamiento"></textarea>
    </div>
    
    <div class="row">
        <div class="col-md-6 mb-3">
            <label for="fecha_limite" class="form-label">Válido hasta</label>
            <input type="date" class="form-control admin-form-control" id="fecha_limite" name="fecha_limite">
        </div>
        
        <!-- CAMPO DE IMAGEN -->
        <div class="col-md-6 mb-3">
            <label for="imagen" class="form-label">Imagen Promocional</label>
            <input type="file" class="form-control admin-form-control" id="imagen" name="imagen" accept="image/*">
        </div>
    </div>

    <div class="form-check mb-3">
        <input class="form-check-input" type="checkbox" id="activo" name="activo" checked>
        <label class="form-check-label" for="activo">Oferta Activa</label>
    </div>
    
    <div class="d-flex justify-content-between mt-4">
        <a href="{% url 'ver_ofertas' %}" class="admin-btn-warning">
            <i class="fas fa-times"></i> Cancelar
        </a>
        <button type="submit" class="admin-btn-primary">
            <i class="fas fa-save"></i> Guardar Oferta
        </button>
    </div>
</form>
{% endblock %}