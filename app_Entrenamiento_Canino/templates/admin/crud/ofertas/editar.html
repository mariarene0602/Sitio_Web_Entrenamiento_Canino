{% extends "admin/crud/base_crud.html" %}

{% block page_title %}Editar Oferta{% endblock %}
{% block page_subtitle %}Modificando cup칩n: {{ oferta.codigo }}{% endblock %}

{% block page_actions %}
<a href="{% url 'ver_ofertas' %}" class="admin-btn-warning">
    <i class="fas fa-arrow-left"></i> Volver a la Lista
</a>
{% endblock %}

{% block card_icon %}edit{% endblock %}
{% block card_title %}Editar Datos{% endblock %}

{% block card_content %}
<!-- IMPORTANTE: enctype="multipart/form-data" para que suba la foto -->
<form method="POST" class="needs-validation" novalidate enctype="multipart/form-data">
    {% csrf_token %}
    
    {% if error %}
    <div class="alert alert-danger">{{ error }}</div>
    {% endif %}
    
    <div class="row">
        <div class="col-md-12 mb-3">
            <label for="curso" class="form-label">Curso Aplicable</label>
            <select class="form-select admin-form-control" id="curso" name="curso">
                <option value="">-- Oferta General --</option>
                {% for curso in cursos %}
                <option value="{{ curso.id }}" {% if oferta.curso.id == curso.id %}selected{% endif %}>
                    {{ curso.nombre }}
                </option>
                {% endfor %}
            </select>
        </div>
    </div>

    <div class="row">
        <div class="col-md-6 mb-3">
            <label class="form-label">C칩digo *</label>
            <input type="text" class="form-control admin-form-control text-uppercase" name="codigo" 
                   value="{{ oferta.codigo }}" required>
        </div>
        
        <div class="col-md-6 mb-3">
            <label class="form-label">Descuento (%) *</label>
            <input type="number" class="form-control admin-form-control" name="porcentaje_descuento" 
                   value="{{ oferta.porcentaje_descuento }}" min="1" max="100" required>
        </div>
    </div>
    
    <div class="mb-3">
        <label class="form-label">Descripci칩n</label>
        <textarea class="form-control admin-form-control" name="descripcion" rows="2">{{ oferta.descripcion }}</textarea>
    </div>
    
    <div class="row">
        <div class="col-md-6 mb-3">
            <label class="form-label">V치lido hasta</label>
            <!-- Truco para formatear la fecha correctamente en el input date -->
            <input type="date" class="form-control admin-form-control" name="fecha_limite" 
                   value="{{ oferta.fecha_limite|date:'Y-m-d' }}">
        </div>
        
        <div class="col-md-6 mb-3">
            <label class="form-label">Imagen</label>
            {% if oferta.imagen %}
                <div class="mb-2">
                    <img src="{{ oferta.imagen.url }}" alt="Actual" style="height: 50px; border-radius: 5px;">
                    <small class="text-muted ms-2">Imagen actual</small>
                </div>
            {% endif %}
            <input type="file" class="form-control admin-form-control" name="imagen" accept="image/*">
        </div>
    </div>

    <div class="form-check mb-3">
        <input class="form-check-input" type="checkbox" name="activo" {% if oferta.activo %}checked{% endif %}>
        <label class="form-check-label">Oferta Activa</label>
    </div>
    
    <div class="d-flex justify-content-between mt-4">
        <a href="{% url 'ver_ofertas' %}" class="admin-btn-warning">
            <i class="fas fa-times"></i> Cancelar
        </a>
        <button type="submit" class="admin-btn-primary">
            <i class="fas fa-save"></i> Guardar Cambios
        </button>
    </div>
</form>
{% endblock %}